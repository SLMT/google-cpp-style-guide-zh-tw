# 類別 (Classes)

類別是 C++ 程式碼中的基本元件。 我們平常會廣泛地使用它。 這章列出了你在撰寫類別的時候，應該以及不應該做的事情。

## 在建構子內的工作

> 避免在建構子內呼叫虛擬函式，而且避免在你無法送出錯誤訊號的時候進行一些可能失敗的初始化工作。

### 定義

建構子內有可能會執行各種初始化工作。

### 優點

- 不需要擔心類別是否已經初始化了。
- 已經經過建構子充分優化的物件可以被設為 `const`，而且對於標準的容器與演算法來說更易於使用。

### 缺點

在建構子內進行工作的問題有：

- 如果在建構子內呼叫虛擬函式，這些呼叫並不會如預期般地分配給衍伸類別內的實作。 就算你的類別現在還沒被繼承，未來針對你的類別的修改可能會默默地造成這種問題，並產生更多疑惑。
- 在不讓程式崩潰 (這不是一直都是個好辦法)，或者丟出例外 (Exception，這個被我們禁止了) 的狀況下，沒有一個簡單的方式能夠從建構子發出錯誤訊號。
- 如果工作失敗了，那我們此時就會有個初始化失敗的物件。 因此這個時候我們可能會需要一個像是 `bool IsValid()` 的方法來檢查狀態，而且它還常常會不小心被忘記。
- 你無法取得建構子的記憶體位址，所以建構子中的工作無法簡單地被移交，例如移交給另一個執行緒。

### 抉擇

建構子內部應該永遠不要呼叫虛擬函式。 如果你覺得合適的話，也許可以終止程式可以當作一種回報錯誤的方式。 除此之外，可以考慮建立工廠方法 (Factory Method) 或者 `Init()` 方法。 避免在那些沒有儲存任何會影響到公用方法 (Public Methods) 的變數的物件中使用 `Init()` 方法 (有這種半建構式的物件存在時很難把程式寫對)。
